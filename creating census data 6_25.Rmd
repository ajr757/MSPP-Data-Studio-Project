---
title: "Census Data"
author: "Ally Rakus"
date: "6/25/2020"
output: html_document
---
Creating my Census API Key 
```{r}

library(tidycensus)

census_api_key("d432da892f8a6ce576e962e7170b27cf7ef13f8d", overwrite = TRUE, install = TRUE) 

```

Looking at the Census Variables
```{r}
v18 <- load_variables(2018, "acs5", cache = TRUE)
v18
```

Call for the variables I need: income, poverty rate, educational attainment, unemployment, race/ethnicity

1. Calling for income and poverty rate 
```{r}
bmore_census_inc_pov <- get_acs(
  geography = "tract", 
  state = "MD",
  county = c("510"),
  variables = c(
    "hh_inc_med" = "B19013_001", # median household inc
    "pov_pct" = "C17002_001")# poverty rate
  , 
  survey = "acs5",
  output = "wide",
  geometry = FALSE)
bmore_census_inc_pov
```
2. Calling for the unemployment table then manipulating that data 
```{r}
bmore_census_unemploy <- get_acs(
  geography = "tract", 
  state = "MD",
  county = c("510"),
  table = "B23001",
  survey = "acs5",
  output = "wide",
  geometry = FALSE)
bmore_census_unemploy
```
Creating variables: labor force, unemployed, unemployment rate
```{r}
bmore_census_unemployment <- bmore_census_unemploy %>% 
   rowwise() %>% 
  mutate(
    laborforce = moe_sum(c_across(c(matches("B23001_0{0,2}[6,13,20,27,34,41,48,55,62,69,74,79,84,92,99,106,113,120,127,134,141,148,155,160,165,170]"))))
 )  %>% 
  ungroup() %>%

   rowwise() %>% 
  mutate(
    pop_unemployed = moe_sum(c_across(c(matches("B23001_0{0,2}[8, 15, 22, 29, 36, 43, 50, 57, 64, 71, 76, 81, 86, 94, 101, 108, 115, 122, 129, 136, 143, 150, 157, 162, 167, 172]"))))
 )  %>% 
  ungroup() %>%
  
mutate(
unemploy_rate = pop_unemployed / na_if(laborforce,0))

bmore_census_unemployment
```
3. Calling the education table then manipulating that data 
```{r}
bmore_census_educ <- get_acs(
  geography = "tract", 
  state = "MD",
  county = c("510"),
  table = "B15003",
  survey = "acs5",
  output = "wide",
  geometry = FALSE)
bmore_census_educ
```
Creating variables: 
```{r}
bmore_census_education <- bmore_census_educ %>%
  mutate 
  (pop_edu_denom = "B15003_001E")
%>%
  rowwise()%>%
  mutate(pop_edu_hs_num = moe_sum(c_across(c(matches("B15003_e{0,2}[17:18*]"))))
 )
ungroup()%>% 

rowwise() %>%
  mutate(
pop_edu_somecoll_plus = moe_sum(c_across(c(matches("B15003_e{19:25*}")))),
) %>%
ungroup()
  
bmore_census_education
```


4. Calling race/ethnicity table then manipulating that data 
```{r}
bmore_census_race <- get_acs(
  geography = "tract", 
  state = "MD",
  county = c("510"),
  table = "B02001",
  survey = "acs5",
  output = "wide",
  geometry = FALSE)
bmore_census_race
```



